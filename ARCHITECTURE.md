# Keep-It-Moving Architecture ðŸš€

## Overview

Keep-It-Moving is a local-first system that enables developers to send prompts from any device to VS Code's GitHub Copilot chat. The system features an embedded server architecture with zero cloud dependencies and focuses on user experience.

## Key Architectural Features

### VS Code Extension with Embedded Server
- Embedded WebSocket server inside VS Code extension
- No external processes needed - everything runs within VS Code
- Dynamic port discovery with automatic fallback
- Extension serves its own web interface

### Embedded PWA Architecture
- PWA served directly from VS Code extension
- QR codes point to extension's embedded server
- URL parameters automatically fill pairing codes
- Responsive design that works on any device

### Authentication System
- UUID v4 tokens for secure authentication
- Session management with automatic expiry
- Automatic cleanup of expired tokens
- User-friendly error messages

## Core Components

### Embedded Server (VS Code Extension)
- **Self-contained**: No external dependencies or processes
- **Dynamic ports**: Automatically finds available ports (8080+)
- **Dual purpose**: Serves both WebSocket API and PWA interface
- **Token-based authentication**: UUID tokens with 24-hour expiry
- **Multi-client support**: Multiple devices can connect simultaneously

### Progressive Web App (Embedded)
- **Served by extension**: No separate hosting required
- **Mobile-optimized**: Responsive design for phones and tablets
- **Real-time connection**: WebSocket client with auto-reconnection
- **QR code support**: Scan codes generated by VS Code extension
- **Manual pairing**: 6-digit code entry as fallback

### VS Code Extension
- **Embedded server**: Runs WebSocket server directly in extension
- **Copilot integration**: Direct prompt injection via `workbench.action.chat.open`
- **QR code generation**: Creates pairing codes with embedded URLs
- **Status management**: Real-time connection status in status bar

## Technical Implementation

### Embedded Server Innovation
Successfully embedded a full WebSocket server inside a VS Code extension:
- Uses Node.js `ws` library directly in extension context
- Zero external dependencies, simple setup
- Eliminates need for separate server processes

### Self-Hosting PWA
Extension serves its own web interface:
- Embedded HTML/CSS/JS directly in extension code
- QR codes point to extension's own server
- No separate hosting required

### Connection Management
Intelligent port discovery system:
- Smart fallback through multiple port ranges
- Handles port conflicts automatically
- Reliable startup process

### Security Implementation
- UUID v4 tokens for authentication
- Session management with automatic expiry
- Local-first approach - no data leaves user's network

### User Experience Features
- Quick setup process
- Universal device support (phones, tablets, laptops)
- User-friendly error messages

## Current Working Flow

### Setup (One-time)
1. Install VS Code extension
2. Run "KIM: Show Pairing Code" command
3. Extension starts embedded server and displays QR code

### Device Pairing
1. Scan QR code or visit `http://[LOCAL_IP]:8080`
2. PWA loads and connects to embedded server
3. Enter 6-digit pairing code (auto-filled from QR in future)
4. Server validates code and issues UUID token
5. Device authenticated and ready for prompts

### Prompt Delivery
1. User types prompt in mobile PWA
2. PWA sends prompt with authentication token
3. Embedded server validates token and routes to VS Code
4. Extension receives prompt and injects into Copilot chat
5. User sees prompt appear in VS Code Copilot interface

### Multi-Device Support
- Multiple devices can pair with same VS Code instance
- Each device gets unique UUID token
- Generate new pairing codes for additional devices
- All devices can send prompts simultaneously

## Key Features

### Custom Message Types
- `pair` - Device authentication
- `prompt` - Prompt relay
- `register_extension` - VS Code registration
- `ping/pong` - Connection monitoring

### Connection Management
- Auto-reconnection with exponential backoff
- Heartbeat monitoring
- Connection state persistence
- Graceful error handling

### Security
- UUID token-based authentication
- Session expiry (5 minutes)
- Input validation
- Local network deployment

## Technical Innovation

The relay pattern enables cross-device communication by:
- Routing messages between different client types
- Maintaining connection state across network changes
- Providing secure device pairing
- Enabling real-time prompt delivery

This architecture could be extended for other IDE integrations or cross-device development tools.